<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.deepknow.goodface.user.repo.UserMapper">

    <!-- 结果映射 -->
    <resultMap id="UserResultMap" type="com.deepknow.goodface.user.repo.entity.User">
        <id column="id" property="id"/>
        <result column="phone" property="phone"/>
        <result column="username" property="username"/>
        <result column="email" property="email"/>
        <result column="membership" property="membership"/>
        <result column="balance" property="balance"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="last_login_at" property="lastLoginAt"/>
    </resultMap>

    <!-- 根据手机号查找用户 -->
    <select id="findByPhone" resultMap="UserResultMap">
        SELECT id, phone, username, email, membership, balance, created_at, updated_at, last_login_at
        FROM users
        WHERE phone = #{phone}
    </select>

    <!-- 根据ID查找用户 -->
    <select id="findById" resultMap="UserResultMap">
        SELECT id, phone, username, email, membership, balance, created_at, updated_at, last_login_at
        FROM users
        WHERE id = #{id}
    </select>

    <!-- 保存用户（插入或更新） -->
    <insert id="save" parameterType="com.deepknow.goodface.user.repo.entity.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO users (phone, username, email, membership, balance, created_at, updated_at, last_login_at)
        VALUES (#{phone}, #{username}, #{email}, #{membership}, #{balance}, #{createdAt}, #{updatedAt}, #{lastLoginAt})
        ON DUPLICATE KEY UPDATE
            username = VALUES(username),
            email = VALUES(email),
            membership = VALUES(membership),
            balance = VALUES(balance),
            updated_at = VALUES(updated_at),
            last_login_at = VALUES(last_login_at)
    </insert>

</mapper>